<!DOCTYPE html>
<html>
<head>
    <title>Whisper Audio Transcription</title>
</head>
<body>
    <h1>Audio Transcription using Whisper</h1>
    <button id="startRecord">Start Recording</button>
    <button id="stopRecord" disabled>Stop Recording</button>
    <p id="transcription"></p>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const startRecord = document.getElementById("startRecord");
            const stopRecord = document.getElementById("stopRecord");
            const transcription = document.getElementById("transcription");
            let mediaRecorder;
            let audioChunks = [];

            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                transcription.innerText = "Your browser does not support audio recording.";
                startRecord.disabled = true;
                return;
            }

            startRecord.addEventListener("click", function() {
                navigator.mediaDevices.getUserMedia({ audio: true })
                    .then(stream => {
                        mediaRecorder = new MediaRecorder(stream);
                        mediaRecorder.start();

                        mediaRecorder.addEventListener("dataavailable", event => {
                            audioChunks.push(event.data);
                        });

                        mediaRecorder.addEventListener("stop", () => {
                            const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                            sendAudioToServer(audioBlob);
                            audioChunks = [];
                        });

                        this.disabled = true;
                        stopRecord.disabled = false;
                    })
                    .catch(error => {
                        transcription.innerText = "Error accessing the microphone: " + error.message;
                    });
            });

            stopRecord.addEventListener("click", function() {
                mediaRecorder.stop();
                this.disabled = true;
                startRecord.disabled = false;
            });

            function sendAudioToServer(audioBlob) {
                const formData = new FormData();
                formData.append("audio", audioBlob);

                fetch("http://192.168.0.8:5000/whisper", {
                    method: "POST",
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    transcription.innerText = "Transcription: " + data.text;
                })
                .catch(error => {
                    console.error("Error in sending audio:", error);
                    transcription.innerText = "Error in sending audio: " + error.message;
                });
            }
        });
    </script>
</body>
</html>
